#下载好bam文件后，用TrimGalore过滤

for file in *_1.fastq.gz
do
    # 根据文件名模式匹配找到配对的文件
    file1="$file"
    file2="${file/_1.fastq.gz/_2.fastq.gz}"
    # 运行 trim_galore
    /Users/yuxin/TrimGalore-0.6.10/trim_galore  -output_dir /Users/yuxin/Downloads/BD_skin/clean --paired --length 150 --quality 25 --stringency 5 -j 10  "$file1" "$file2"
done

#创建x86的conda环境
##注意M series mac必须使用x86版本的conda环境才能使用bioconda
## create empty environment
conda create -n ngstools
## activate environment
conda activate ngstools
## configure architecture
conda config --env --set subdir osx-64
## configure channels for Bioconda
conda config --env --add channels defaults
conda config --env --add channels bioconda
conda config --env --add channels conda-forge
## install packages
conda install fastqc multiqc sra-tools samtools bowtie2 hisat2 subread

#安装hisat2
conda install bioconda::hisat2
conda activate ngstools
#注意grch38的索引在全局，且后面加/genome；下载地址：https://genome-idx.s3.amazonaws.com/hisat/grch38_genome.tar.gz
for file in *_1_val_1.fq.gz
do
    file1="$file"
    file2="${file/_1_val_1.fq.gz/_2_val_2.fq.gz}"
    file3="${file/_1_val_1.fq.gz/.sam}"
    hisat2 -p 10 -x /Users/yuxin/Downloads/BD_skin/clean2/grch38/genome -1 "$file1" -2 "$file2" -S "$file3"
done

